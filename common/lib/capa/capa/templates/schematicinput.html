<span>
  <input type="hidden" class="schematic" height="${height}" width="${width}" parts="${parts}" analyses="${analyses}" name="input_${id}" id="input_${id}" aria-label="${label}" aria-describedby="answer_${id}" value="" initial_value=""/>

  <div id="value_${id}" style="display:none">${value}</div>
  <div id="initial_value_${id}" style="display:none">${initial_value}</div>
  <div id="submit_value_${id}" style="display:none">${submit_analyses}</div>

  <span id="answer_${id}"></span>
  % if status == 'unsubmitted':
  <span class="ui-icon ui-icon-bullet" style="display:inline-block;" id="status_${id}" aria-describedby="input_${id}">
    <span class="sr">Status: unsubmitted</span>
  </span>
  % elif status == 'correct':
  <span class="ui-icon ui-icon-check" style="display:inline-block;" id="status_${id}" aria-describedby="input_${id}">
    <span class="sr">Status: correct</span>
  </span>
  % elif status == 'incorrect':
  <span class="ui-icon ui-icon-close" style="display:inline-block;" id="status_${id}" aria-describedby="input_${id}">
    <span class="sr">Status: incorrect</span>
  </span>
  % elif status == 'incomplete':
  <span class="ui-icon ui-icon-close" style="display:inline-block;" id="status_${id}" aria-describedby="input_${id}">
    <span class="sr">Status: incomplete</span>
  </span>
  % endif
</span>

<script>
  // TODO: someone should fix all of this...
  var schematic_height = 220;
  var schematic_width = 400;
  var styling_height_delta = 2; //How many pixels are added to the height of the box because of styling (like a shadow)
  var styling_width_delta = 2;

  var schematic_editor_height = 300;
  var schematic_editor_width = 500;

  $(function() {
      $("#input_${id}").attr("value",$("#value_${id}").text());
      $("#input_${id}").attr("initial_value",$("#initial_value_${id}").text());
      $("#input_${id}").attr("submit_analyses",$("#submit_value_${id}").text());

      //$("a[rel*=leanModal]").leanModal(); //TODO: Make this work with the new modal library. Try and integrate this with the "slices"

      $("body").append('\
      <div id="circuit_editor_modal" class="modal hide fade"> \
        <div class="modal-body"> \
          <input class="schematic" height="' + schematic_editor_height + '" width="' + schematic_editor_width + '" id="schematic_editor" name="schematic" type="hidden" value=""/> \
        </div> \
        <div class="modal-footer"> \
          <button type="button" id="circuit_save_btn" class="btn btn-primary" data-dismiss="modal"> \
            Save circuit \
          </button> \
        </div> \
      </div>');

      //This is the editor that pops up as a modal
      var editorCircuit = $("#schematic_editor").get(0);
      //This is the circuit that they last clicked. The one being edited.
      var editingCircuit = null;
      //Notice we use live, because new circuits can be inserted
      $(".schematic_open").live("click", function() {
        //Find the new editingCircuit. Transfer its contents to the editorCircuit
        editingCircuit = $(this).children("input.schematic").get(0);

        editingCircuit.schematic.update_value();
        var circuit_so_far = $(editingCircuit).val();

        var n = editorCircuit.schematic.components.length;
        for (var i = 0; i < n; i++)
          editorCircuit.schematic.components[n - 1 - i].remove();

        editorCircuit.schematic.load_schematic(circuit_so_far, "");
        editorCircuit.schematic.zoomall();
      });

      $("#circuit_save_btn").click(function () {
        //Take the circuit from the editor and put it back into editingCircuit
        editorCircuit.schematic.update_value();
        var saving_circuit = $(editorCircuit).val();

        var n = editingCircuit.schematic.components.length;
        for (var i = 0; i < n; i++)
          editingCircuit.schematic.components[n - 1 - i].remove();

        editingCircuit.schematic.load_schematic(saving_circuit, "");
        editingCircuit.schematic.zoomall();

        if (editingCircuit.codeMirrorLine) {
          editingCircuit.codeMirrorLine.replace(0, null, "circuit-schematic:" + saving_circuit);
        }
      });
  });
</script>