<%! from django.utils.translation import ugettext as _ %>

<%namespace name='static' file='/static_content.html'/>

<%block name="jsextra">
  <script>  
    var save_url = '${save_url}';
    var schedule = ${schedule};
  </script>
    <script src="${static.url('js/vendor/backbone-min.js')}"></script>
  <script src="${static.url('js/vendor/timepicker/jquery.timepicker.js')}"></script>
  <link rel="stylesheet" type="text/css" href="${static.url('js/vendor/timepicker/jquery.timepicker.css')}" />
  <style>
    .ui-timepicker-list { z-index: 100000; }
    .ui-datepicker { z-index: 100000 !important; }
    input.date, input.time { width: auto !important; display: inline !important; }
  </style>
  <%static:js group='ccx'/>
</%block>

%for template_name in ["schedule"]:
  <script type="text/template" id="ccx-${template_name}-template">
    <%static:include path="ccx/${template_name}.underscore" />
  </script>
%endfor

<div class="ccx-schedule-container">
  <div id="ccx-schedule"></div>
  <div id="new-ccx-schedule"></div>
</div>

<section id="enter-date-modal" class="modal"
         tabindex="1" role="dialog" aria-labelledby="ccx_schedule_set_date_heading">
  <div class="inner-wrapper">
    <button class="close-modal" tabindex="2">
      <i class="icon fa fa-remove" aria-hidden="true"></i>
      <span class="sr">
        ${_("Close")}
      </span>
    </button>
    <header>
      <h2 tabindex="2" id="ccx_schedule_set_date_heading"></h2>
    </header>
    <form role="form">
      <div class="field datepair">
        <input placeholder="Date" class="date" type="text" name="date"
               id="date" size="11" tabindex="2" aria-label="${_('Enter date format yyyy-mm-dd')}">
        <input placeholder="Time" class="time" type="text" name="time" id="time" size="6"
               tabindex="2" aria-label="${_('Enter time format hh-mm')}">
      </div>
      <div class="field">
        <button type="submit" class="btn btn-primary" tabindex="2">${_('Set date')}</button>
      </div>
    </form>
  </div>
</section>

<div class="ccx-schedule-sidebar">
  <div class="ccx-sidebar-panel" id="dirty-schedule" tabindex="1" role="group"
       aria-labelledby="ccx_schedule_save_changes_heading">
    <h2 id="ccx_schedule_save_changes_heading">${_('Save changes')}</h2>
    <form>
      <p id="message_save" tabindex="2">${_("You have unsaved changes.")}</p>
      <div class="field">
        <br/>
        <button id="save-changes" aria-describedby="message_save" tabindex="2">${_("Save changes")}</button>
      </div>
    </form>
  </div>
  <div class="ccx-sidebar-panel" id="ajax-error" tabindex="1" role="group" aria-labelledby="ccx_schedule_error_message">
    <h2>${_('Error')}</h2>
    <p id="ccx_schedule_error_message">${_("There was an error saving changes.")}</p>
  </div>
  <div class="ccx-sidebar-panel" tabindex="2" aria-labelledby="ccx_schedule_unit"
       id="ccx_schedule_unit_panel" role="group">
    <h2 id="ccx_schedule_unit">${_('Schedule a Unit')}</h2>
    <form role="form" id="add-unit" name="add-unit" class="ccx-form">
      <div class="field">
        <label for="ccx_chapter"><b>${_('Section')}</b></label>
        <select name="chapter" id="ccx_chapter" tabindex="2" ></select>
      </div>
      <div class="field">
        <label for="ccx_sequential"><b>${_('Subsection')}</b></label>
        <select name="sequential" id="ccx_sequential" tabindex="2"></select>
      </div>
      <div class="field">
        <label for="ccx_vertical"><b>${_('Unit')}</b></label>
        <select name="vertical" id="ccx_vertical" tabindex="2"></select>
      </div>
      <div class="field datepair">
        <label for="ccx_start_date"><b>${_('Start Date')}</b></label>
        <input placeholder="yyyy-mm-dd" type="text" class="date" name="start_date" id="ccx_start_date"
               aria-label="${_('Start Date')} format yyyy-mm-dd" tabindex="2"/>
        <label for="ccx_start_time" class="sr">${_('Start Time format HH:mm')}</label>
        <input placeholder="time" type="text" class="time" name="start_time" id="ccx_start_time" tabindex="2"/>
      </div>
      <div class="field datepair">
        <label for="ccx_due_date"><b>${_('Due Date')}</b> ${_('(Optional)')}</label>
        <input placeholder="yyyy-mm-dd" type="text" class="date" name="due_date" id="ccx_due_date"
                aria-label="${_('Due Date Optional')} format yyyy-mm-dd" tabindex="2"/>
        <label for="ccx_due_time" class="sr">${_('Due Time format HH:mm')}</label>
        <input placeholder="time" type="text" class="time" name="due_time" id="ccx_due_time" tabindex="2"/>
      </div>
      <div class="field">
        <br/>
        <button id="add-unit-button" tabindex="2">${_('Add Unit')}</button>
      </div>
      <div class="field">
        <br/>
        <button id="add-all" tabindex="2">${_('Add All Units')}</button>
      </div>
    </form>
    <div id="all-units-added" tabindex="3">
      ${_("All units have been added.")}
    </div>
  </div>
</div>

<script>
$(function() {
    schedule_template = _.template($('#ccx-schedule-template').html());
    var view = new edx.ccx.schedule.ScheduleView({
        el: $('#new-ccx-schedule')
    });
    view.render();
    //ccx_schedule.render();
    $('.datepair .time').timepicker({
        'showDuration': true,
        'timeFormat': 'G:i',
        'autoclose': true
    });
    $('.datepair .date').datepicker({
        'dateFormat': 'yy-mm-dd',
        'autoclose': true
    });
    $('.datepair .date').change(function() {
       var date = $(this).datepicker( "getDate" );
       if (date) {
           $(this).val(date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate());
       }
    });
});
</script>
